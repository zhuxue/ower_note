# 04-前后端分离-2-分离实践

## 一 什么是前后端分离?

早期的 web 开发中，大量使用模板引擎技术，如果 Java 中的 jsp，Node 中的 ejs。在具体开发中，前端只负责 html 与 css，以及简单的 js 特效，后端不但要开发 API，还要负责对页面中的数据进行渲染：

- 1 浏览器打开一个网址
- 2 发送请求给后台
- 3 后台根据请求产生数据后，利用 ejs、jsp 等技术，生成 一个 html 文本
- 4 后台将生成的 html 文本发送给前台
- 5 浏览器获取 html 文本直接渲染

所谓前后端分离即摆脱之前的耦合开发方式，让属于前端的范畴交给前端（数据渲染交给前端），在这种情况下的工作方式：

- 1 浏览器打开一个网址
- 2 发送请求给后台
- 3 后台根据请求产生数据后，直接将数据发送给前台
- 4 前台拿到数据后，进行 dom 操作，修改当前页面中的数据为后台提供的动态数据

我们发现，少了一步后台拼接 html 文本的过程，这个过程交给了前端进行自己处理。前端实现该过程最常见的办法就是 SPA(Single-page application)，所有用到的展现数据都是后端通过异步接口(AJAX/JSONP)的方式提供的，前端只管展现。

## 二 前后端分离前的问题

Ajax 为主 SPA 型开发模式，比较适合开发 APP 类型的场景，但是只适合做 APP，因为 SEO 等问题不好解决，对于很多类型的系统，这种开发方式也过重。

## 三 分离实践

1、一般来说，要实现前后端分离，前端就需要开启一个本地的服务器来运行自己的前端代码，以此来模拟真实的线上环境，并且能更好的开发。利用 nodejs 的 express 框架来开启一个本地的服务器，然后利用 nodejs 的一个 http-proxy-middleware 插件将客户端发往 nodejs 的请求转发给真正的服务器，让 nodejs 作为一个中间层。

2、由于前后端分离后，前端和后台同时开发时，就可能遇到前端已经开发好一个页面了，可是却等待后台 API 接口的情况。比如说 A 是负责前端，B 是负责后台，A 可能用了一周做好了基本的结构，并且需要 API 接口联调后，才能继续开发，而此时 B 却还没有实现好所需要的接口，这种情况，怎么办呢？在我们这个项目里，我们是通过了 mock 来提供一些假数据，我们先规定好了 API 接口，设计出了一套 API 文档，然后我们就可以通过 API 文档，利用 mock(<http://mockjs.com)来返回一些假数据，这样就可以模拟发送API>到接受响应的整一个过程，因此前端也不需要依赖于后端开发了，可以独立开发。

Node 在前后端分离中主要扮演了创建本地开发环境的角色，和生产环境无关。

## 四 Node 聚合层

在第三步中已经完成了前后分离。在很多场景中，一个页面会请求很多接口，多次请求自然也造成了很多网络 I/O。为了解决这些问题，一些公司额外引入了 Node 聚合层。  
在前端与后端之间，再部署 Node 服务器，由 Node 服务器去请求多个接口，聚合数据后为前端提供一个统一接口。
